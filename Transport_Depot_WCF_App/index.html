<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html>
<head>
    <title></title>
  <style type="text/css">
    body { font-size:small; }
    table { border-collapse: collapse; }
    table tr td 
    { 
      border: solid 1px #ccc; 
      padding: .2em;
    }
    .right {
      text-align: right;
    }
    .even { background-color:#ddd; }
  </style>
</head>
<body >
  <div ng-app='freightApp'>
    <table >
      <thead>
        <tr>
          <th>
            Truck<br/>Trip#
          </th>
          <th>
            Trailer<br/>Driver Phone
          </th>
          <th>
            Driver<br/>Card
          </th>
          <th>
            Line Haul<br/>Pickup
          </th>
          <th>
            Arrival
          </th>
          <th>
            Truck<br/>Trip#
          </th>                
      </tr>
        </thead>
      <tbody ng-controller="freightController" > 
        <tr ng-repeat="trip in trips">
          <td>{{trip.Tractor}}<br/>{{trip.TripNumber}}</td>
          <td>{{trip.Trailer}}<br/>{{trip.Drivers[0].CellPhone}}</td>
          <td>{{trip.Drivers[0].Name}}<br/>{{trip.Drivers[0].Card}}</td>
          <td>{{trip.From.State}} - {{trip.To.State}}<br/>{{trip.From.Date | date: "MM/dd/yyyy"}}</td>
          <td>{{trip.To.Date | date: "MM/dd/yyyy"}}<br/>{{trip.To.City}}</td>
          
          
          <td>{{trip.Customer.Name}}<br/>{{trip.Customer.Phone}}</td>
        </tr>
      </tbody>
    </table>

  </div>

    
  
  <script src="//code.jquery.com/jquery-1.11.1.min.js"></script>
  <script src="//ajax.googleapis.com/ajax/libs/angularjs/1.2.26/angular.min.js"></script>  
  <script type="text/javascript"> 
    function parseWcfDate(wcfDate){
        var d=wcfDate.match(/(\d+)/)[1];
        return new Date(+d);
    }
    var app = angular.module('freightApp', []);
    
    app.controller('freightController', function($scope, $http){
       $http.get("http://192.168.1.200/settlements/Dispatch.svc/GetMovingFreight")
        .success(function(response) {
          $scope.trips = response.GetMovingFreightResult;
          angular.forEach($scope.trips, function(trip, key) {
            trip.From.Date = parseWcfDate(trip.From.DateTime);
            trip.To.Date = parseWcfDate(trip.To.DateTime);
          });
          
        }).error(function (http, status, fnc, httpObj ) {
          console.log('albums retrieval failed.',http,status,httpObj);
        });
    });
  </script>
</body>
</html>